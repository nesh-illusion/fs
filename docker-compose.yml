services:
  lucius-orchestrator:
    build:
      context: .
      dockerfile: services/lucius-orchestrator/Dockerfile
    ports:
      - "8000:8000"
    environment:
      LUCIUS_STORAGE_BACKEND: "memory"

  lucius-dispatcher-0:
    build:
      context: .
      dockerfile: services/lucius-dispatcher/Dockerfile
    environment:
      LUCIUS_STORAGE_BACKEND: "memory"
    command: ["lucius-reconciliation", "loop", "--shard-index", "0", "--shard-count", "2", "--interval", "5"]

  lucius-dispatcher-1:
    build:
      context: .
      dockerfile: services/lucius-dispatcher/Dockerfile
    environment:
      LUCIUS_STORAGE_BACKEND: "memory"
    command: ["lucius-reconciliation", "loop", "--shard-index", "1", "--shard-count", "2", "--interval", "5"]

  vector-ingestion:
    build:
      context: .
      dockerfile: services/vector-ingestion/Dockerfile

  distributed-ocr:
    build:
      context: .
      dockerfile: services/distributed-ocr/Dockerfile

  semantic-intelligence:
    build:
      context: .
      dockerfile: services/semantic-intelligence/Dockerfile

  test_runner:
    build:
      context: .
      dockerfile: services/test_runner/Dockerfile
    environment:
      PYTHONDONTWRITEBYTECODE: "1"
      TMPDIR: "/tmp"
    depends_on:
      - lucius-orchestrator
      - lucius-dispatcher-0
      - lucius-dispatcher-1
      - distributed-ocr
      - vector-ingestion
      - semantic-intelligence
