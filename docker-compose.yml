services:
  lucius_orchestrator:
    build:
      context: .
      dockerfile: services/lucius_orchestrator/Dockerfile
    ports:
      - "8000:8000"
    environment:
      LUCIUS_STORAGE_BACKEND: "memory"

  lucius_dispatcher:
    build:
      context: .
      dockerfile: services/lucius_dispatcher/Dockerfile
    environment:
      LUCIUS_STORAGE_BACKEND: "memory"
    command: ["lucius-reconciliation", "loop", "--partition", "t1#202401", "--interval", "5"]

  embedding:
    build:
      context: .
      dockerfile: services/embedding/Dockerfile

  ocr:
    build:
      context: .
      dockerfile: services/ocr/Dockerfile

  sis:
    build:
      context: .
      dockerfile: services/sis/Dockerfile

  test_runner:
    build:
      context: .
      dockerfile: services/test_runner/Dockerfile
    environment:
      PYTHONDONTWRITEBYTECODE: "1"
      TMPDIR: "/tmp"
    depends_on:
      - lucius_orchestrator
      - lucius_dispatcher
      - ocr
      - embedding
      - sis
